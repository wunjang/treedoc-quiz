<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê¸°ì¶œë¬¸ì œ ìŠ¤ë§ˆíŠ¸ ê²€ìƒ‰ ì‹œìŠ¤í…œ</title>
    <style>
        :root { --primary: #3b82f6; --secondary: #10b981; --accent: #f59e0b; --bg: #f8fafc; }
        body { font-family: 'Pretendard', sans-serif; background: var(--bg); padding: 20px; color: #1e293b; }
        .container { max-width: 900px; margin: 0 auto; }

        /* í•„í„° íŒ¨ë„ */
        .filter-panel { background: white; padding: 25px; border-radius: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); margin-bottom: 20px; position: sticky; top: 10px; z-index: 100; }
        .filter-row { margin-bottom: 15px; }
        .label { font-weight: bold; display: block; margin-bottom: 8px; color: #64748b; font-size: 0.9em; }
        
        .tag-group { display: flex; flex-wrap: wrap; gap: 8px; }
        .tag { padding: 6px 14px; background: #f1f5f9; border-radius: 50px; cursor: pointer; font-size: 0.85em; border: 1px solid #e2e8f0; transition: 0.2s; }
        .tag.session.active { background: var(--secondary); color: white; }
        .tag.subject.active { background: var(--primary); color: white; }

        /* í‚¤ì›Œë“œ ê²€ìƒ‰ì°½ ë° ìë™ì™„ì„± */
        .search-container { position: relative; width: 100%; }
        #keywordInput { width: 100%; padding: 12px; border-radius: 8px; border: 2px solid #e2e8f0; box-sizing: border-box; outline: none; }
        #keywordInput:focus { border-color: var(--accent); }
        .autocomplete-list { position: absolute; width: 100%; background: white; border: 1px solid #e2e8f0; border-top: none; max-height: 200px; overflow-y: auto; z-index: 101; display: none; border-radius: 0 0 8px 8px; }
        .autocomplete-item { padding: 10px; cursor: pointer; border-bottom: 1px solid #f1f5f9; }
        .autocomplete-item:hover { background: #fef3c7; }

        /* ì„ íƒëœ í‚¤ì›Œë“œ ì¹© */
        .selected-keywords { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; }
        .kw-chip { background: var(--accent); color: white; padding: 5px 12px; border-radius: 4px; display: flex; align-items: center; gap: 8px; font-size: 0.85em; }
        .kw-chip span { cursor: pointer; font-weight: bold; }

        /* ë¬¸ì œ ì¹´ë“œ */
        .q-card { background: white; padding: 20px; border-radius: 12px; margin-bottom: 15px; border: 1px solid #e2e8f0; }
        .ans-section { display: none; margin-top: 15px; padding: 15px; background: #f0fdf4; border-left: 4px solid #22c55e; }
        .ans-section.show { display: block; }
        .btn-ans { width: 100%; margin-top: 10px; padding: 8px; cursor: pointer; background: #f8fafc; border: 1px solid #cbd5e1; border-radius: 6px; }
    </style>
</head>
<body>

<div class="container">
    <div class="filter-panel">
        <div class="filter-row">
            <span class="label">ğŸ“… íšŒì°¨ (OR)</span>
            <div id="sessionGroup" class="tag-group"></div>
        </div>
        <div class="filter-row">
            <span class="label">ğŸ“˜ ê³¼ëª© (OR)</span>
            <div id="subjectGroup" class="tag-group"></div>
        </div>
        <div class="filter-row">
            <span class="label">ğŸ” í‚¤ì›Œë“œ ê²€ìƒ‰ (AND - ì…ë ¥ í›„ ì„ íƒ)</span>
            <div class="search-container">
                <input type="text" id="keywordInput" placeholder="í‚¤ì›Œë“œ ì…ë ¥ (ì˜ˆ: SQL, OSI...)" oninput="handleSearch(this.value)">
                <div id="autocompleteList" class="autocomplete-list"></div>
            </div>
            <div id="keywordChips" class="selected-keywords"></div>
        </div>
        <div style="text-align: right; border-top: 1px solid #eee; padding-top: 10px;">
            <span id="resultCount" style="font-weight: bold; color: var(--primary);"></span>
            <button onclick="resetAll()" style="margin-left:15px; cursor:pointer;">ì´ˆê¸°í™”</button>
        </div>
    </div>

    <div id="questionList"></div>
</div>

<script>
    let questions = [];
    let selectedSessions = new Set();
    let selectedSubjects = new Set();
    let selectedKeywords = new Set();
    let allUniqueKeywords = [];

    async function loadData() {
        // ì‹¤ì œ ìš´ì˜ ì‹œ: const res = await fetch('questions.json');
        // ì§€ê¸ˆì€ í…ŒìŠ¤íŠ¸ìš© ë”ë¯¸ ë°ì´í„°
        questions = [
            { id: 1, session: "2023-01", subject: "ë°ì´í„°ë² ì´ìŠ¤", tags: ["SQL", "DDL", "ì •ê·œí™”"], question: "DDLì— í•´ë‹¹í•˜ëŠ” ëª…ë ¹ì–´ëŠ”?", options: ["CREATE", "INSERT", "UPDATE", "DELETE"], answer: 0, explanation: "CREATEëŠ” ì •ì˜ì–´ì…ë‹ˆë‹¤." },
            { id: 2, session: "2023-02", subject: "ë°ì´í„°ë² ì´ìŠ¤", tags: ["SQL", "DML", "ì •ê·œí™”"], question: "DMLì— í•´ë‹¹í•˜ëŠ” ëª…ë ¹ì–´ëŠ”?", options: ["CREATE", "ALTER", "INSERT", "DROP"], answer: 2, explanation: "INSERTëŠ” ì¡°ì‘ì–´ì…ë‹ˆë‹¤." },
            { id: 3, session: "2023-01", subject: "ìš´ì˜ì²´ì œ", tags: ["ë°ë“œë½", "ìŠ¤ì¼€ì¤„ë§"], question: "êµì°©ìƒíƒœ ë°œìƒ ì¡°ê±´ì´ ì•„ë‹Œ ê²ƒì€?", options: ["ìƒí˜¸ë°°ì œ", "ì ìœ ëŒ€ê¸°", "ì„ ì ", "í™˜í˜•ëŒ€ê¸°"], answer: 2, explanation: "ë¹„ì„ ì ì´ ì¡°ê±´ì…ë‹ˆë‹¤." }
        ];
        
        initFilters();
        processAndRender();
    }

    function initFilters() {
        const sessions = [...new Set(questions.map(q => q.session))].sort();
        const subjects = [...new Set(questions.map(q => q.subject))].sort();
        allUniqueKeywords = [...new Set(questions.flatMap(q => q.tags))].sort();

        document.getElementById('sessionGroup').innerHTML = sessions.map(s => `<div class="tag session" onclick="toggleFilter('session', '${s}', this)">${s}</div>`).join('');
        document.getElementById('subjectGroup').innerHTML = subjects.map(s => `<div class="tag subject" onclick="toggleFilter('subject', '${s}', this)">${s}</div>`).join('');
    }

    function toggleFilter(type, value, el) {
        const set = type === 'session' ? selectedSessions : selectedSubjects;
        if (set.has(value)) set.delete(value); else set.add(value);
        el.classList.toggle('active');
        processAndRender();
    }

    // í‚¤ì›Œë“œ ìë™ì™„ì„± ë° ê²€ìƒ‰ ë¡œì§
    function handleSearch(val) {
        const list = document.getElementById('autocompleteList');
        if (!val) { list.style.display = 'none'; return; }

        const filtered = allUniqueKeywords.filter(k => k.toLowerCase().includes(val.toLowerCase()) && !selectedKeywords.has(k));
        
        if (filtered.length > 0) {
            list.innerHTML = filtered.map(k => `<div class="autocomplete-item" onclick="addKeyword('${k}')">${k}</div>`).join('');
            list.style.display = 'block';
        } else {
            list.style.display = 'none';
        }
    }

    function addKeyword(kw) {
        selectedKeywords.add(kw);
        document.getElementById('keywordInput').value = '';
        document.getElementById('autocompleteList').style.display = 'none';
        renderChips();
        processAndRender();
    }

    function removeKeyword(kw) {
        selectedKeywords.delete(kw);
        renderChips();
        processAndRender();
    }

    function renderChips() {
        document.getElementById('keywordChips').innerHTML = [...selectedKeywords].map(kw => `
            <div class="kw-chip">${kw} <span onclick="removeKeyword('${kw}')">Ã—</span></div>
        `).join('');
    }

    function processAndRender() {
        let result = questions;

        // 1ë‹¨ê³„: íšŒì°¨ í•„í„° (OR)
        if (selectedSessions.size > 0) result = result.filter(q => selectedSessions.has(q.session));
        
        // 2ë‹¨ê³„: ê³¼ëª© í•„í„° (OR)
        if (selectedSubjects.size > 0) result = result.filter(q => selectedSubjects.has(q.subject));

        // 3ë‹¨ê³„: í‚¤ì›Œë“œ í•„í„° (AND)
        if (selectedKeywords.size > 0) {
            result = result.filter(q => [...selectedKeywords].every(kw => q.tags.includes(kw)));
        }

        // ì •ë ¬ (ì˜¤ë¦„ì°¨ìˆœ ê³ ì •)
        result.sort((a, b) => a.session.localeCompare(b.session) || a.number - b.number);

        document.getElementById('resultCount').innerText = `ê²°ê³¼: ${result.length}ê±´`;
        renderQuestions(result);
    }

    function renderQuestions(data) {
        document.getElementById('questionList').innerHTML = data.map(q => `
            <div class="q-card">
                <small style="color:#64748b">${q.session} | ${q.subject}</small>
                <div style="font-weight:bold; margin: 10px 0;">${q.question}</div>
                <div style="font-size:0.9em; color:#475569">${q.tags.map(t => '#'+t).join(' ')}</div>
                <button class="btn-ans" onclick="this.nextElementSibling.classList.toggle('show')">ì •ë‹µ í™•ì¸</button>
                <div class="ans-section">ì •ë‹µ: ${q.answer + 1}<br><small>${q.explanation}</small></div>
            </div>
        `).join('');
    }

    function resetAll() {
        selectedSessions.clear();
        selectedSubjects.clear();
        selectedKeywords.clear();
        document.querySelectorAll('.tag').forEach(t => t.classList.remove('active'));
        renderChips();
        processAndRender();
    }

    loadData();
</script>
</body>
</html>