<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê¸°ì¶œë¬¸ì œ ë§ˆìŠ¤í„° - ë‹¤ì¤‘ íƒœê·¸ í•„í„°</title>
    <style>
        :root { --primary: #3b82f6; --bg: #f8fafc; --text: #1e293b; }
        body { font-family: 'Pretendard', sans-serif; background: var(--bg); color: var(--text); line-height: 1.6; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; }
        
        /* í•„í„° ì„¹ì…˜ */
        .filter-panel { background: white; padding: 20px; border-radius: 16px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); margin-bottom: 25px; position: sticky; top: 15px; z-index: 50; }
        .tag-list { display: flex; flex-wrap: wrap; gap: 8px; margin: 15px 0; }
        .tag { padding: 6px 14px; background: #f1f5f9; border: 1px solid #e2e8f0; border-radius: 50px; cursor: pointer; font-size: 0.9em; transition: 0.2s; user-select: none; }
        .tag.active { background: var(--primary); color: white; border-color: var(--primary); }
        .tag:hover { border-color: var(--primary); }

        /* ì»¨íŠ¸ë¡¤ ë²„íŠ¼ */
        .controls { display: flex; justify-content: space-between; align-items: center; margin-top: 15px; }
        select { padding: 8px; border-radius: 8px; border: 1px solid #cbd5e1; }
        .btn-reset { background: #ef4444; color: white; border: none; padding: 8px 15px; border-radius: 8px; cursor: pointer; }

        /* ë¬¸ì œ ì¹´ë“œ */
        .q-card { background: white; padding: 25px; border-radius: 16px; margin-bottom: 20px; border: 1px solid #e2e8f0; }
        .q-meta { font-size: 0.85em; color: #64748b; font-weight: 600; margin-bottom: 10px; }
        .q-title { font-size: 1.2em; font-weight: 700; margin-bottom: 20px; }
        .q-image { max-width: 100%; border-radius: 10px; margin-bottom: 20px; display: block; }
        .options-list { list-style: none; padding: 0; display: grid; gap: 10px; }
        .opt { padding: 12px 15px; border: 1px solid #e2e8f0; border-radius: 10px; transition: 0.2s; }
        .opt:hover { background: #eff6ff; border-color: #bfdbfe; }
        
        /* ì •ë‹µ ì˜ì—­ */
        .ans-section { margin-top: 20px; padding: 15px; background: #f0fdf4; border-radius: 10px; display: none; border-left: 4px solid #22c55e; }
        .ans-section.show { display: block; }
        .btn-ans { width: 100%; margin-top: 15px; padding: 10px; background: #64748b; color: white; border: none; border-radius: 8px; cursor: pointer; }
    </style>
</head>
<body>

<div class="container">
    <div class="filter-panel">
        <h2 style="margin:0 0 10px 0;">ğŸ” ë¬¸ì œ í•„í„°ë§</h2>
        <small>íƒœê·¸ë¥¼ í´ë¦­í•˜ì—¬ ì—¬ëŸ¬ ê°œë¥¼ ë™ì‹œì— ì„ íƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</small>
        <div class="tag-list" id="tagContainer"></div>
        
        <div class="controls">
            <div>
                <select id="sortSelect" onchange="processAndRender()">
                    <option value="asc">íšŒì°¨/ë²ˆí˜¸ ìˆœ (ì˜¤ë¦„ì°¨ìˆœ)</option>
                    <option value="desc">íšŒì°¨/ë²ˆí˜¸ ìˆœ (ë‚´ë¦¼ì°¨ìˆœ)</option>
                </select>
                <button class="btn-reset" onclick="resetFilters()">í•„í„° ì´ˆê¸°í™”</button>
            </div>
            <button onclick="toggleMasterAnswer()" style="padding:8px 15px; border-radius:8px; cursor:pointer;">ì „ì²´ ì •ë‹µ í† ê¸€</button>
        </div>
    </div>

    <div id="mainDisplay"></div>
</div>

<script>
    let questions = [];      // ì›ë³¸ ë°ì´í„°
    let selectedTags = new Set(); // ì„ íƒëœ íƒœê·¸ë“¤
    let globalShowAnswer = false;

    // 1. JSON ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
    async function fetchData() {
        try {
            const response = await fetch('questions.json');
            questions = await response.json();
            renderTagButtons();
            processAndRender();
        } catch (error) {
            console.error("ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤:", error);
            document.getElementById('mainDisplay').innerHTML = "JSON íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê²½ë¡œë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.";
        }
    }

    // 2. íƒœê·¸ ë²„íŠ¼ ìƒì„± (ì¤‘ë³µ ì œê±°)
    function renderTagButtons() {
        const allTags = [...new Set(questions.flatMap(q => q.tags))];
        const container = document.getElementById('tagContainer');
        container.innerHTML = allTags.map(tag => 
            `<div class="tag" id="tag-${tag}" onclick="toggleTag('${tag}')">${tag}</div>`
        ).join('');
    }

    // 3. íƒœê·¸ í† ê¸€ ë¡œì§
    function toggleTag(tag) {
        if (selectedTags.has(tag)) {
            selectedTags.delete(tag);
            document.getElementById(`tag-${tag}`).classList.remove('active');
        } else {
            selectedTags.add(tag);
            document.getElementById(`tag-${tag}`).classList.add('active');
        }
        processAndRender();
    }

    function resetFilters() {
        selectedTags.clear();
        document.querySelectorAll('.tag').forEach(t => t.classList.remove('active'));
        processAndRender();
    }

    // 4. í•„í„°ë§ + ì •ë ¬ + ë Œë”ë§ í†µí•© í”„ë¡œì„¸ìŠ¤
    function processAndRender() {
        let filtered = questions;

        // íƒœê·¸ í•„í„°ë§ (ì„ íƒëœ íƒœê·¸ê°€ í•˜ë‚˜ë¼ë„ ìˆìœ¼ë©´ í•„í„° ì ìš©)
        if (selectedTags.size > 0) {
            filtered = questions.filter(q => 
                q.tags.some(t => selectedTags.has(t))
            );
        }

        // ì •ë ¬
        const sortOrder = document.getElementById('sortSelect').value;
        filtered.sort((a, b) => {
            const sessionCmp = a.session.localeCompare(b.session);
            if (sessionCmp !== 0) return sortOrder === 'asc' ? sessionCmp : -sessionCmp;
            return sortOrder === 'asc' ? a.number - b.number : b.number - a.number;
        });

        renderQuestions(filtered);
    }

    function renderQuestions(data) {
        const display = document.getElementById('mainDisplay');
        if (data.length === 0) {
            display.innerHTML = "<p style='text-align:center; padding:50px;'>ì¡°ê±´ì— ë§ëŠ” ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.</p>";
            return;
        }

        display.innerHTML = data.map(q => `
            <div class="q-card">
                <div class="q-meta">${q.session} | ${q.number}ë²ˆ | ${q.tags.join(', ')}</div>
                <div class="q-title">${q.question}</div>
                ${q.image ? `<img src="${q.image}" class="q-image" alt="ë¬¸ì œ ì´ë¯¸ì§€">` : ''}
                <div class="options-list">
                    ${q.options.map((opt, i) => `<div class="opt">${i+1}. ${opt}</div>`).join('')}
                </div>
                <button class="btn-ans" onclick="toggleSingleAnswer(this)">ì •ë‹µ í™•ì¸</button>
                <div class="ans-section ${globalShowAnswer ? 'show' : ''}">
                    <strong>ì •ë‹µ: ${q.answer + 1}</strong><p>${q.explanation}</p>
                </div>
            </div>
        `).join('');
    }

    function toggleSingleAnswer(btn) {
        const ans = btn.nextElementSibling;
        ans.classList.toggle('show');
    }

    function toggleMasterAnswer() {
        globalShowAnswer = !globalShowAnswer;
        processAndRender();
    }

    // ì‹¤í–‰ ì‹œì‘
    fetchData();
</script>

</body>
</html>