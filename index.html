<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê¸°ì¶œë¬¸ì œ ìŠ¤ë§ˆíŠ¸ ê²€ìƒ‰ ì‹œìŠ¤í…œ</title>
    <style>
        :root { --primary: #3b82f6; --secondary: #10b981; --accent: #f59e0b; --bg: #f8fafc; }
        body { font-family: 'Pretendard', sans-serif; background: var(--bg); padding: 20px; color: #1e293b; }
        .container { max-width: 900px; margin: 0 auto; }

        .filter-panel { background: white; padding: 25px; border-radius: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); margin-bottom: 20px; position: sticky; top: 10px; z-index: 100; }
        .filter-row { margin-bottom: 15px; }
        .label { font-weight: bold; display: block; margin-bottom: 8px; color: #64748b; font-size: 0.9em; }
        
        .tag-group { display: flex; flex-wrap: wrap; gap: 8px; }
        .tag { padding: 6px 14px; background: #f1f5f9; border-radius: 50px; cursor: pointer; font-size: 0.85em; border: 1px solid #e2e8f0; transition: 0.2s; user-select: none; }
        .tag.session.active { background: var(--secondary); color: white; border-color: var(--secondary); }
        .tag.subject.active { background: var(--primary); color: white; border-color: var(--primary); }

        .search-container { position: relative; width: 100%; }
        #keywordInput { width: 100%; padding: 12px; border-radius: 8px; border: 2px solid #e2e8f0; box-sizing: border-box; outline: none; }
        #keywordInput:focus { border-color: var(--accent); }
        .autocomplete-list { position: absolute; width: 100%; background: white; border: 1px solid #e2e8f0; border-top: none; max-height: 200px; overflow-y: auto; z-index: 101; display: none; border-radius: 0 0 8px 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .autocomplete-item { padding: 10px; cursor: pointer; }
        .autocomplete-item:hover { background: #fef3c7; }

        .selected-keywords { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px; }
        .kw-chip { background: var(--accent); color: white; padding: 5px 12px; border-radius: 4px; display: flex; align-items: center; gap: 8px; font-size: 0.85em; }
        .kw-chip span { cursor: pointer; font-weight: bold; }

        .q-card { background: white; padding: 20px; border-radius: 12px; margin-bottom: 15px; border: 1px solid #e2e8f0; }
        .ans-section { display: none; margin-top: 15px; padding: 15px; background: #f0fdf4; border-left: 4px solid #22c55e; border-radius: 8px; }
        .ans-section.show { display: block; }
        .btn-ans { width: 100%; margin-top: 15px; padding: 10px; cursor: pointer; background: #f8fafc; border: 1px solid #cbd5e1; border-radius: 8px; font-weight: bold; }
        .options-list { display: grid; gap: 8px; margin: 15px 0; }
        .option-item { padding: 10px; border: 1px solid #f1f5f9; border-radius: 6px; background: #fafafa; font-size: 0.95em; }
    </style>
</head>
<body>

<div class="container">
    <div class="filter-panel">
        <div class="filter-row">
            <span class="label">ğŸ“… íšŒì°¨ ì„ íƒ (OR)</span>
            <div id="sessionGroup" class="tag-group"></div>
        </div>
        <div class="filter-row">
            <span class="label">ğŸ“˜ ê³¼ëª© ì„ íƒ (OR)</span>
            <div id="subjectGroup" class="tag-group"></div>
        </div>
        <div class="filter-row">
            <span class="label">ğŸ” í‚¤ì›Œë“œ ê²€ìƒ‰ (AND)</span>
            <div class="search-container">
                <input type="text" id="keywordInput" placeholder="í‚¤ì›Œë“œ ì…ë ¥ í›„ ì„ íƒ..." oninput="handleSearch(this.value)">
                <div id="autocompleteList" class="autocomplete-list"></div>
            </div>
            <div id="keywordChips" class="selected-keywords"></div>
        </div>
        <div style="display: flex; justify-content: space-between; align-items: center; border-top: 1px solid #eee; padding-top: 15px;">
            <span id="resultCount" style="font-weight: bold; color: var(--primary);">ê²°ê³¼: 0ê±´</span>
            <button onclick="resetAll()" style="padding: 5px 15px; cursor:pointer;">í•„í„° ì´ˆê¸°í™”</button>
        </div>
    </div>

    <div id="questionList"></div>
</div>

<script>
    let questions = [];
    let selectedSessions = new Set();
    let selectedSubjects = new Set();
    let selectedKeywords = new Set();
    let allUniqueKeywords = [];

    // 1. ë°ì´í„° ë¡œë“œ
    async function loadData() {
        try {
            const response = await fetch('questions.json');
            if (!response.ok) throw new Error('questions.json íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            questions = await response.json();
            
            initFilters();    // í•„í„° ë²„íŠ¼ ìƒì„±
            processAndRender(); // ì´ˆê¸° í™”ë©´ ë Œë”ë§
        } catch (error) {
            console.error(error);
            document.getElementById('questionList').innerHTML = `<p style="color:red; text-align:center;">${error.message}</p>`;
        }
    }

    // 2. í•„í„° ë²„íŠ¼ ì´ˆê¸°í™”
    function initFilters() {
        const sessions = [...new Set(questions.map(q => q.session))].sort();
        const subjects = [...new Set(questions.map(q => q.subject))].sort();
        allUniqueKeywords = [...new Set(questions.flatMap(q => q.tags))].sort();

        document.getElementById('sessionGroup').innerHTML = sessions.map(s => 
            `<div class="tag session" onclick="toggleFilter('session', '${s}', this)">${s}</div>`
        ).join('');

        document.getElementById('subjectGroup').innerHTML = subjects.map(s => 
            `<div class="tag subject" onclick="toggleFilter('subject', '${s}', this)">${s}</div>`
        ).join('');
    }

    // 3. í•„í„° í† ê¸€ (íšŒì°¨, ê³¼ëª©)
    function toggleFilter(type, value, el) {
        const targetSet = (type === 'session') ? selectedSessions : selectedSubjects;
        if (targetSet.has(value)) targetSet.delete(value);
        else targetSet.add(value);
        
        el.classList.toggle('active');
        processAndRender();
    }

    // 4. í‚¤ì›Œë“œ ê²€ìƒ‰ ë° ìë™ì™„ì„±
    function handleSearch(val) {
        const list = document.getElementById('autocompleteList');
        if (!val) { list.style.display = 'none'; return; }

        const filtered = allUniqueKeywords.filter(k => 
            k.toLowerCase().includes(val.toLowerCase()) && !selectedKeywords.has(k)
        );
        
        if (filtered.length > 0) {
            list.innerHTML = filtered.map(k => `<div class="autocomplete-item" onclick="addKeyword('${k}')">${k}</div>`).join('');
            list.style.display = 'block';
        } else {
            list.style.display = 'none';
        }
    }

    function addKeyword(kw) {
        selectedKeywords.add(kw);
        document.getElementById('keywordInput').value = '';
        document.getElementById('autocompleteList').style.display = 'none';
        renderChips();
        processAndRender();
    }

    function removeKeyword(kw) {
        selectedKeywords.delete(kw);
        renderChips();
        processAndRender();
    }

    function renderChips() {
        document.getElementById('keywordChips').innerHTML = [...selectedKeywords].map(kw => `
            <div class="kw-chip">${kw} <span onclick="removeKeyword('${kw}')">Ã—</span></div>
        `).join('');
    }

    // 5. í•„í„°ë§ ë¡œì§ ë° ë Œë”ë§
    function processAndRender() {
        let result = questions;

        // íšŒì°¨ í•„í„° (OR)
        if (selectedSessions.size > 0) {
            result = result.filter(q => selectedSessions.has(q.session));
        }
        
        // ê³¼ëª© í•„í„° (OR)
        if (selectedSubjects.size > 0) {
            result = result.filter(q => selectedSubjects.has(q.subject));
        }

        // í‚¤ì›Œë“œ í•„í„° (AND)
        if (selectedKeywords.size > 0) {
            result = result.filter(q => [...selectedKeywords].every(kw => q.tags.includes(kw)));
        }

        // ì •ë ¬ (ì˜¤ë¦„ì°¨ìˆœ)
        result.sort((a, b) => a.session.localeCompare(b.session) || a.number - b.number);

        document.getElementById('resultCount').innerText = `ê²°ê³¼: ${result.length}ê±´`;
        renderQuestions(result);
    }

    // 6. ë¬¸ì œ ì¹´ë“œ ìƒì„±
    function renderQuestions(data) {
        const listEl = document.getElementById('questionList');
        if (data.length === 0) {
            listEl.innerHTML = '<p style="text-align:center; padding:50px; color:#64748b;">ì¡°ê±´ì— ë§ëŠ” ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            return;
        }

        listEl.innerHTML = data.map(q => `
            <div class="q-card">
                <small style="color:#64748b">${q.session} | ${q.subject} | ${q.number}ë²ˆ</small>
                <div style="font-weight:bold; margin: 10px 0; font-size:1.1em;">${q.question}</div>
                ${q.image ? `<img src="${q.image}" style="max-width:100%; border-radius:8px; margin-bottom:10px;">` : ''}
                
                <div class="options-list">
                    ${q.options.map((opt, i) => `<div class="option-item">${i + 1}. ${opt}</div>`).join('')}
                </div>

                <button class="btn-ans" onclick="toggleAns(this)">ì •ë‹µ í™•ì¸</button>
                <div class="ans-section">
                    <strong>ì •ë‹µ: ${q.answer + 1}</strong>
                    <p style="margin-top:10px; font-size:0.9em; color:#475569;">${q.explanation}</p>
                </div>
            </div>
        `).join('');
    }

    function toggleAns(btn) {
        btn.nextElementSibling.classList.toggle('show');
    }

    function resetAll() {
        selectedSessions.clear();
        selectedSubjects.clear();
        selectedKeywords.clear();
        document.querySelectorAll('.tag').forEach(t => t.classList.remove('active'));
        document.getElementById('keywordInput').value = '';
        renderChips();
        processAndRender();
    }

    // ì´ˆê¸° ì‹¤í–‰
    loadData();
</script>

</body>
</html>