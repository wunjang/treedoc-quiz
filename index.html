<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê¸°ì¶œë¬¸ì œ ë§ˆìŠ¤í„° - ì ‘ì´ì‹ í•„í„°</title>
    <style>
        :root { --primary: #3b82f6; --secondary: #10b981; --accent: #f59e0b; --bg: #f1f5f9; }
        body { font-family: 'Pretendard', sans-serif; background: var(--bg); padding: 15px; margin: 0; color: #1e293b; }
        .container { max-width: 800px; margin: 0 auto; }

        /* í•„í„° íŒ¨ë„ ìŠ¤íƒ€ì¼ ìˆ˜ì • */
        .filter-panel { 
            background: white; 
            border-radius: 16px; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.1); 
            margin-bottom: 20px; 
            position: sticky; 
            top: 10px; 
            z-index: 100;
            overflow: hidden;
            border: 1px solid #e2e8f0;
        }

        /* í•„í„° í—¤ë” (í•­ìƒ ë³´ì„) */
        .filter-header {
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            background: #fff;
            user-select: none;
        }
        .filter-header h2 { margin: 0; font-size: 1.1em; display: flex; align-items: center; gap: 8px; }
        .filter-summary { font-size: 0.85em; color: var(--primary); font-weight: bold; }

        /* ì ‘íˆëŠ” ì˜ì—­ */
        .filter-content {
            padding: 0 20px 20px 20px;
            max-height: 1000px; /* ì¶©ë¶„íˆ í° ê°’ */
            transition: max-height 0.3s ease-out, opacity 0.2s;
            opacity: 1;
        }
        .filter-panel.collapsed .filter-content {
            max-height: 0;
            padding-bottom: 0;
            opacity: 0;
            pointer-events: none;
        }

        /* íƒœê·¸ ë° ê²€ìƒ‰ì°½ ìŠ¤íƒ€ì¼ */
        .filter-row { margin-top: 15px; }
        .label { font-weight: bold; display: block; margin-bottom: 8px; color: #64748b; font-size: 0.85em; }
        .tag-group { display: flex; flex-wrap: wrap; gap: 6px; }
        .tag { padding: 6px 12px; background: #f8fafc; border-radius: 50px; cursor: pointer; font-size: 0.8em; border: 1px solid #e2e8f0; }
        .tag.active.session { background: var(--secondary); color: white; border-color: var(--secondary); }
        .tag.active.subject { background: var(--primary); color: white; border-color: var(--primary); }

        .search-container { position: relative; }
        #keywordInput { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #cbd5e1; outline: none; font-size: 16px; /* ëª¨ë°”ì¼ ì¤Œ ë°©ì§€ */ }
        .autocomplete-list { position: absolute; width: 100%; background: white; border: 1px solid #e2e8f0; max-height: 150px; overflow-y: auto; z-index: 110; display: none; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .autocomplete-item { padding: 10px; cursor: pointer; font-size: 0.9em; }
        .autocomplete-item:hover { background: #fef3c7; }

        .selected-keywords { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 10px; }
        .kw-chip { background: var(--accent); color: white; padding: 4px 10px; border-radius: 4px; font-size: 0.8em; display: flex; align-items: center; gap: 5px; }

        /* ë¬¸ì œ ì¹´ë“œ */
        .q-card { background: white; padding: 20px; border-radius: 12px; margin-bottom: 15px; border: 1px solid #e2e8f0; }
        .btn-ans { width: 100%; margin-top: 15px; padding: 12px; cursor: pointer; background: #f8fafc; border: 1px solid #cbd5e1; border-radius: 8px; font-weight: bold; }
        .ans-section { display: none; margin-top: 10px; padding: 15px; background: #f0fdf4; border-radius: 8px; border-left: 4px solid #22c55e; }
        .ans-section.show { display: block; }

        /* í™”ì‚´í‘œ ì•„ì´ì½˜ */
        .arrow { transition: transform 0.3s; }
        .collapsed .arrow { transform: rotate(-180deg); }

        /* ë¬¸ì œ ë‚´ë¶€ì— í¬í•¨ëœ <ë³´ê¸°> ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
        .inner-box {
            background-color: #ffffff;
            border: 1px dashed #444; /* ì ì„  í…Œë‘ë¦¬ */
            padding: 12px 15px;
            margin: 10px 0;
            font-size: 0.95em;
            line-height: 1.7;
            border-radius: 4px;
            display: block;
            word-break: keep-all; /* ë‹¨ì–´ ë‹¨ìœ„ ì¤„ë°”ê¿ˆ */
        }

        /* ë°•ìŠ¤ ì•ˆì˜ í•­ëª©(ã„±, ã„´, ã„·) ê°•ì¡° */
        .inner-box b {
            color: var(--primary);
            margin-right: 5px;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="filter-panel" id="filterPanel">
        <div class="filter-header" onclick="togglePanel()">
            <h2>ğŸ” í•„í„° ì„¤ì • <span id="headerResultCount" style="font-size: 0.8em; color: #64748b;"></span></h2>
            <div style="display: flex; align-items: center; gap: 10px;">
                <span class="filter-summary" id="filterSummary">ì „ì²´ ë³´ê¸°</span>
                <span class="arrow">â–²</span>
            </div>
        </div>
        
        <div class="filter-content">
            <div class="filter-row">
                <span class="label">ğŸ“… íšŒì°¨ (OR)</span>
                <div id="sessionGroup" class="tag-group"></div>
            </div>
            <div class="filter-row">
                <span class="label">ğŸ“˜ ê³¼ëª© (OR)</span>
                <div id="subjectGroup" class="tag-group"></div>
            </div>
            <div class="filter-row">
                <span class="label">ğŸ”‘ í‚¤ì›Œë“œ (AND)</span>
                <div class="search-container">
                    <input type="text" id="keywordInput" placeholder="í‚¤ì›Œë“œ ê²€ìƒ‰ ë° ì„ íƒ..." oninput="handleSearch(this.value)">
                    <div id="autocompleteList" class="autocomplete-list"></div>
                </div>
                <div id="keywordChips" class="selected-keywords"></div>
            </div>
            <div style="margin-top: 20px; display: flex; justify-content: flex-end;">
                <button onclick="resetAll()" style="padding: 8px 15px; background: #ef4444; color: white; border: none; border-radius: 6px; cursor: pointer;">ì´ˆê¸°í™”</button>
            </div>
        </div>
    </div>

    <div id="questionList"></div>
</div>



<script>
    let questions = [];
    let selectedSessions = new Set();
    let selectedSubjects = new Set();
    let selectedKeywords = new Set();
    let allUniqueKeywords = [];

    async function loadData() {
        try {
            const response = await fetch('questions.json');
            if (!response.ok) throw new Error('íŒŒì¼ ë¡œë“œ ì‹¤íŒ¨');
            questions = await response.json();
            initFilters();
            processAndRender();
        } catch (e) {
            document.getElementById('questionList').innerHTML = `<p style="color:red; text-align:center;">${e.message}</p>`;
        }
    }

    function initFilters() {
        const sessions = [...new Set(questions.map(q => q.session))].sort();
        const subjects = [...new Set(questions.map(q => q.subject))].sort();
        allUniqueKeywords = [...new Set(questions.flatMap(q => q.tags))].sort();

        document.getElementById('sessionGroup').innerHTML = sessions.map(s => `<div class="tag session" onclick="toggleFilter('session', '${s}', this)">${s}</div>`).join('');
        document.getElementById('subjectGroup').innerHTML = subjects.map(s => `<div class="tag subject" onclick="toggleFilter('subject', '${s}', this)">${s}</div>`).join('');
    }

    function togglePanel() {
        document.getElementById('filterPanel').classList.toggle('collapsed');
    }

    function toggleFilter(type, value, el) {
        const set = type === 'session' ? selectedSessions : selectedSubjects;
        if (set.has(value)) set.delete(value); else set.add(value);
        el.classList.toggle('active');
        processAndRender();
    }

    function handleSearch(val) {
        const list = document.getElementById('autocompleteList');
        if (!val) { list.style.display = 'none'; return; }
        const filtered = allUniqueKeywords.filter(k => k.toLowerCase().includes(val.toLowerCase()) && !selectedKeywords.has(k));
        list.innerHTML = filtered.map(k => `<div class="autocomplete-item" onclick="addKeyword('${k}')">${k}</div>`).join('');
        list.style.display = filtered.length ? 'block' : 'none';
    }

    function addKeyword(kw) {
        selectedKeywords.add(kw);
        document.getElementById('keywordInput').value = '';
        document.getElementById('autocompleteList').style.display = 'none';
        renderChips();
        processAndRender();
    }

    function removeKeyword(kw) {
        selectedKeywords.delete(kw);
        renderChips();
        processAndRender();
    }

    function renderChips() {
        document.getElementById('keywordChips').innerHTML = [...selectedKeywords].map(kw => `<div class="kw-chip">${kw} <span onclick="removeKeyword('${kw}')">Ã—</span></div>`).join('');
    }

    function processAndRender() {
        let res = questions;
        if (selectedSessions.size) res = res.filter(q => selectedSessions.has(q.session));
        if (selectedSubjects.size) res = res.filter(q => selectedSubjects.has(q.subject));
        if (selectedKeywords.size) res = res.filter(q => [...selectedKeywords].every(k => q.tags.includes(k)));

        res.sort((a, b) => a.session.localeCompare(b.session) || a.number - b.number);
        
        // ìƒíƒœ ìš”ì•½ ì—…ë°ì´íŠ¸
        const summary = [];
        if (selectedSessions.size) summary.push(`íšŒì°¨ ${selectedSessions.size}`);
        if (selectedSubjects.size) summary.push(`ê³¼ëª© ${selectedSubjects.size}`);
        if (selectedKeywords.size) summary.push(`í‚¤ì›Œë“œ ${selectedKeywords.size}`);
        document.getElementById('filterSummary').innerText = summary.length ? summary.join(', ') : 'ì „ì²´ ë³´ê¸°';
        document.getElementById('headerResultCount').innerText = `(${res.length}ê±´)`;

        renderQuestions(res);
    }

    function renderQuestions(data) {
        const listEl = document.getElementById('questionList');
        
        if (data.length === 0) {
            listEl.innerHTML = '<p style="text-align:center; padding:50px; color:#64748b;">ì¡°ê±´ì— ë§ëŠ” ë¬¸ì œê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
            return;
        }

        listEl.innerHTML = data.map(q => `
            <div class="q-card">
                <small style="color:#64748b">${q.session} | ${q.subject} | ${q.number}ë²ˆ</small>
                
                <div class="q-title" style="font-weight:bold; margin: 10px 0; font-size:1.1em; line-height:1.6;">
                    ${q.question}
                </div>
                
                ${q.image ? `<img src="images/${q.image}" style="max-width:100%; border-radius:8px; margin-bottom:10px; display:block;">` : ''}
                
                <div class="options-list" style="display:grid; gap:8px; margin: 15px 0;">
                    ${q.options.map((opt, i) => `
                        <div style="padding:10px; border:1px solid #eee; border-radius:6px; background:#fafafa; font-size:0.95em;">
                            ${i + 1}. ${opt}
                        </div>
                    `).join('')}
                </div>

                <button class="btn-ans" onclick="this.nextElementSibling.classList.toggle('show')" 
                        style="width:100%; padding:10px; cursor:pointer; background:#f8fafc; border:1px solid #cbd5e1; border-radius:8px; font-weight:bold;">
                    ì •ë‹µ í™•ì¸
                </button>
                <div class="ans-section" style="display:none; margin-top:10px; padding:15px; background:#f0fdf4; border-left:4px solid #22c55e; border-radius:8px;">
                    <strong>ì •ë‹µ: ${q.answer + 1}</strong>
                    <p style="margin-top:10px; font-size:0.9em; color:#475569;">${q.explanation || 'í•´ì„¤ì´ ì—†ìŠµë‹ˆë‹¤.'}</p>
                </div>
            </div>
        `).join('');
    }

    function resetAll() {
        selectedSessions.clear(); selectedSubjects.clear(); selectedKeywords.clear();
        document.querySelectorAll('.tag').forEach(t => t.classList.remove('active'));
        renderChips(); processAndRender();
    }

    loadData();
</script>
</body>
</html>